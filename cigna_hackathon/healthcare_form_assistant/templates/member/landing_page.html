{% extends "member/base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
    <div class="container">
        <!-- Left Panel: PhilHealth Search -->
        <div class="left-panel">
            {% if patient %}
            <form method="post" action="{% url 'generate-pdf' %}">
            {% csrf_token %}
                <div class="result-box">
                    <h3>Member Information</h3>
                    <p><strong>PhilHealth ID:</strong> {{ patient.ph_id }}</p>
                    <p><strong>Name:</strong> {{ patient.get_fullname }}</p>
                    <p><strong>Birthdate:</strong> {{ patient.birth_date }}</p>
                    <p><strong>Age:</strong> {{ patient.get_age }}</p>
                    <button class="cf1_generator">CF1</button>
                </div>
            </form>
            {% else %}
            <h2>Search Member Entry</h2>
            <form method="GET">
                <div class="search-box">
                    <input type="text" name="philhealth_id" placeholder="Enter Member ID" required>
                    <button type="submit">Search</button>
                </div>
                <p style="margin-top:20px; color:#777;">
                    Enter a PhilHealth ID to search for a member's record. This will fetch details from the database or connected EMR/HIS system.
                </p>
            </form>
            {% endif %}
        </div>

        <div class="right-panel">
            {% if transactions %}
            <h1>All Medical Transactions</h1>
            <table>
                <thead>
                    <tr>
                        <th>Application Date</th>

                        <th>Facility Name</th>
                        <th>Attending Physician</th>
                        <th>License No.</th>

                        <th>Statement Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for transaction in transactions %}
                    <tr>
                        <td>{{ transaction.date }}</td>

                        <td>{{ transaction.provider.facility.name }}</td>
                        <td>{{ transaction.provider.first_name }}</td>
                        <td>{{ transaction.provider.license_no }}</td>

                        <td>{{ transaction.statement_date }}</td>
                        <td>
                            <div class="action-buttons">
                                <button>CF2</button>
                                <button>CF3</button>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="9">No transactions found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <h2>Form AI Assistant</h2>
            <p>
                Welcome to the <strong>Form AI Assistant</strong>! This tool is designed to automatically assist healthcare staff in generating PhilHealth claim forms — including <strong>CF1, CF2, and CF3</strong> — by extracting information directly from the patient's EMR and HIS records.
            </p>
            <p>
                The assistant analyzes the patient’s medical records, vital signs, diagnoses, procedures, and admission details to pre-fill the forms accurately, reducing manual entry and minimizing errors. 
            </p>
            <p>
                Users simply need to search for a PhilHealth ID or member record, and the AI assistant will guide them through each form, providing contextual suggestions, validations, and notifications for missing or inconsistent data.
            </p>
            {% endif %}
        </div>
    </div>
{% endblock %}